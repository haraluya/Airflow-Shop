# Airflow B2B 電商平台 - 功能修正與補完計劃

## 📋 巡查結果總覽

**巡查日期**: 2025-09-02  
**整體完成度**: 約 70%  
**核心電商功能**: 85% 完成  
**B2B 特色功能**: 55% 完成  

## 🚨 發現的重大功能缺失

### 第一優先級：核心功能缺失

#### 1. 訂單系統不完整 ❌
**問題描述**:
- 有 `src/lib/types/order.ts` 型別定義，但缺少對應的 Firebase 服務
- 購物車到訂單的轉換邏輯不完整
- 後台訂單管理頁面缺失

**影響範圍**: 
- 客戶無法完成購買流程
- 管理員無法管理訂單
- 整個電商系統核心功能受阻

**需要補完的功能**:
- [ ] `src/lib/firebase/orders.ts` - 訂單 Firebase 服務
- [ ] 購物車轉訂單的完整邏輯
- [ ] 後台訂單列表頁面 `/admin/dashboard/orders`
- [ ] 後台訂單詳情頁面 `/admin/dashboard/orders/[id]`
- [ ] 訂單狀態更新介面

#### 2. 代客下單功能缺失 ❌
**問題描述**:
- 第四階段驗收標準要求「代客下單功能正常運作」
- 目前只在儀表板顯示「代客下單」按鈕，無實際功能

**需要補完的功能**:
- [ ] 管理員代客下單介面
- [ ] 客戶選擇與搜尋機制
- [ ] 代下單訂單標記與記錄

#### 3. 重複儀表板架構混亂 ⚠️
**問題描述**:
- 同時存在 `src/app/(dashboard)` 和 `src/app/(admin)/admin/dashboard` 兩套系統
- 路由常數與實際路徑不一致
- 可能造成功能混亂與維護困難

**需要修正**:
- [ ] 統一儀表板架構，移除重複目錄
- [ ] 更新路由常數與實際路徑的一致性
- [ ] 清理過時的頁面與元件

### 第二優先級：B2B特色功能缺失

#### 4. 業務員門戶系統完全缺失 ❌
**問題描述**:
- 第五階段規劃要求「業務員專屬後台」「績效儀表板」「客戶與訂單查詢」
- 有完整的 `SalespersonProfile` 型別定義，但無相關功能實現
- 影響推薦碼分銷系統的完整性

**需要補完的功能**:
- [ ] 業務員登入後的專屬後台介面
- [ ] 業務員績效儀表板（銷售統計、客戶數量、訂單金額）
- [ ] 業務員客戶列表查詢
- [ ] 業務員訂單查詢與追蹤
- [ ] 佣金計算與記錄系統

#### 5. 推薦碼管理系統不完整 ⚠️
**問題描述**:
- 推薦碼前端展示功能完整，但缺少後台管理
- 無推薦碼效果統計與追蹤
- 業務員績效無法計算

**需要補完的功能**:
- [ ] 推薦碼生成與管理介面
- [ ] 推薦碼使用統計與分析
- [ ] 業務員推薦效果追蹤
- [ ] 推薦碼與客戶綁定記錄管理

## 🔧 系統架構問題

### 1. Firebase 服務層不完整
**缺失的服務**:
- [ ] `src/lib/firebase/orders.ts` - 訂單服務
- [ ] `src/lib/firebase/salesperson.ts` - 業務員服務  
- [ ] `src/lib/firebase/referrals.ts` - 推薦碼追蹤服務
- [ ] `src/lib/firebase/reports.ts` - 報表與統計服務

### 2. 路由與權限不一致
**問題**:
- 路由常數定義與實際頁面路徑不匹配
- 業務員角色權限定義完整，但相關頁面未實現
- 推薦碼路由與一般路由的權限邏輯需整合

### 3. 型別定義與實際實現不對應
**問題**:
- 訂單型別定義完整，但缺少對應服務
- 業務員型別定義完整，但缺少相關功能
- 推薦碼相關型別可能需要擴充

## 📅 修復實施計劃

### 階段一：核心訂單系統修復 (1-2週)

#### Week 1: 訂單服務建立
- [ ] 建立 `src/lib/firebase/orders.ts`
  - 訂單 CRUD 操作
  - 訂單狀態管理
  - 訂單搜尋與篩選
- [ ] 完成購物車轉訂單邏輯
  - 整合價格計算
  - 庫存檢查
  - 訂單編號生成
- [ ] 建立後台訂單管理頁面
  - 訂單列表 `/admin/dashboard/orders`
  - 訂單詳情 `/admin/dashboard/orders/[id]`
  - 訂單狀態更新介面

#### Week 2: 代客下單功能
- [ ] 代客下單介面設計
  - 客戶搜尋與選擇
  - 商品選擇與數量設定
  - 地址與付款方式設定
- [ ] 代客下單邏輯實現
  - 權限檢查（僅管理員可用）
  - 訂單標記與記錄
  - 通知機制

#### Week 2: 架構清理
- [ ] 移除重複的 `(dashboard)` 目錄
- [ ] 統一儀表板路由結構
- [ ] 更新路由常數定義
- [ ] 清理過時的元件與頁面

### 階段二：業務員系統建立 (2-3週)

#### Week 3-4: 業務員後台
- [ ] 建立 `src/lib/firebase/salesperson.ts`
- [ ] 業務員登入後路由設計 `/salesperson/dashboard`
- [ ] 業務員績效儀表板
  - 銷售統計圖表
  - 客戶數量統計
  - 訂單金額追蹤
- [ ] 業務員客戶管理
  - 綁定客戶列表
  - 客戶詳情查看
  - 客戶備忘錄管理

#### Week 5: 推薦碼管理完善
- [ ] 建立 `src/lib/firebase/referrals.ts`
- [ ] 推薦碼管理介面
  - 推薦碼生成與編輯
  - 推薦碼啟用/停用
  - 推薦碼效果統計
- [ ] 業務員佣金系統
  - 佣金計算邏輯
  - 佣金記錄與查詢
  - 績效報表生成

### 階段三：系統整合與測試 (1週)

#### Week 6: 功能串接測試
- [ ] 完整電商流程測試
  - 註冊 → 審核 → 購物 → 下單 → 管理
- [ ] 推薦碼系統測試
  - 推薦碼綁定 → 客戶購買 → 業務員績效
- [ ] 權限系統驗證
  - 各角色權限邊界測試
  - 路由保護機制驗證
- [ ] 資料一致性檢查
  - Firebase 資料完整性
  - 前後端資料同步

## 🎯 驗收標準

### 核心功能驗收
- [ ] 客戶可以完成完整購買流程（註冊→瀏覽→購買→下單→查看訂單）
- [ ] 管理員可以管理所有訂單並執行代客下單
- [ ] 推薦碼系統完整運作（URL解析→客戶綁定→業務員績效追蹤）

### B2B特色功能驗收
- [ ] 業務員可以查看自己的績效資料
- [ ] 業務員可以管理綁定的客戶
- [ ] 推薦碼管理與統計功能正常
- [ ] 佣金計算與記錄準確

### 系統穩定性驗收
- [ ] 所有頁面載入無錯誤
- [ ] 資料庫操作無遺漏或重複
- [ ] 權限控制嚴格且正確
- [ ] 效能符合預期標準

## 🚨 風險評估與備案

### 高風險項目
1. **訂單系統重構** - 可能影響現有購物車功能
   - 備案：分階段實施，保留舊功能直到新功能穩定
   
2. **架構清理** - 可能造成現有功能中斷
   - 備案：備份現有代碼，分步驟遷移

### 中風險項目
1. **業務員系統** - 新功能可能與現有權限衝突
   - 備案：獨立開發，最後整合
   
2. **推薦碼完善** - 可能影響現有推薦機制
   - 備案：保持向後相容，逐步升級

## 📊 預期成果

修復完成後，系統將達到：
- **整體完成度**: 95%+
- **核心電商功能**: 100% 完成
- **B2B 特色功能**: 90%+ 完成
- **系統穩定性**: 生產就緒

完成修復後，Airflow 將成為一個完整的 B2B 電商與 CRM 整合平台，具備完整的訂單管理、業務員分銷、推薦碼追蹤等核心功能。