# Airflow B2B 電商平台 - 上下文工程前導指南

> **本專案採用上下文工程方法論，讓AI助手能夠準確理解專案架構並高效執行開發任務。**

## 🚀 專案簡介

Airflow 是專為電子煙批發產業設計的整合性B2B電商與CRM平台，採用Next.js 14 + Firebase的現代化Serverless架構。

**核心特色：**
- 🎯 B2B批發電商與CRM整合
- 🔐 多角色權限系統（管理員/客戶/業務員）
- 💰 個人化價格引擎與群組定價
- 🔗 推薦碼分銷系統
- 📊 Notion雙向同步（過渡方案）
- 🎨 完整的UI/UX設計系統

## 📋 快速開始

### 1. 環境準備 (Windows 11)

```powershell
# 確認Node.js版本 (需要18.x或更高版本)
node --version

# 確認Git設定
git config --global core.autocrlf true

# 安裝Firebase CLI (需要12.1.0或更新版本)
npm install -g firebase-tools
firebase --version
```

### 2. 使用上下文工程工作流程

**第一次使用時：**

```powershell
# 1. 進入專案目錄
cd D:\APP\test-project\Airflow-shop\context-engineering-intro

# 2. 閱讀專案概況（手動完成）
# - 閱讀 INITIAL.md 了解專案需求
# - 閱讀 CLAUDE.md 了解開發規範
# - 閱讀 商城規劃軟體需求規格生成.md 了解詳細需求

# 3. 在Claude Code中使用上下文工程指令
```

**開發新功能時：**

```bash
# 在Claude Code中執行以下命令

# 1. 生成PRP（產品需求提示）
/generate-prp INITIAL.md

# 2. 執行PRP實作功能
/execute-prp PRPs/your-feature-name.md
```

## 📁 專案結構說明

```
Airflow-shop/
├── context-engineering-intro/          # 上下文工程前導
│   ├── INITIAL.md                     # 專案需求概覽
│   ├── CLAUDE.md                      # 開發規範與階段規劃
│   ├── README.md                      # 本文件
│   ├── 商城規劃軟體需求規格生成.md      # 完整SRS文件
│   ├── PRPs/                          # 自動生成的實作藍圖
│   ├── examples/                      # 程式碼範例（待建立）
│   └── .claude/                       # Claude Code設定
├── src/                               # 主要程式碼（將建立）
├── functions/                         # Firebase Functions（將建立）
└── README.md                          # 專案主要README（將建立）
```

## 🏗️ 開發階段與使用指南

### 階段一：基礎架構與認證系統 (2-3週)
**使用方式：**
1. 先閱讀CLAUDE.md中的「第一階段」任務
2. 執行 `/generate-prp` 生成基礎架構PRP
3. 執行 `/execute-prp` 建立Next.js專案與Firebase設定

**預期產出：**
- Next.js 14專案骨架
- Firebase專案設定完成
- 基礎認證系統
- TypeScript + Tailwind CSS設定

### 階段二：客戶管理與CRM系統 (3-4週)
**使用方式：**
1. 更新INITIAL.md中的CRM相關需求
2. 生成CRM功能的PRP
3. 執行實作客戶註冊、審核、管理功能

**預期產出：**
- 客戶註冊與審核流程
- CRM資料管理介面
- 多地址管理功能

### 階段三：產品管理與價格引擎 (3-4週)
**使用方式：**
1. 參考SRS文件中的價格引擎邏輯
2. 生成產品管理與定價系統PRP
3. 實作商品CRUD、富文本編輯器、價格計算

**預期產出：**
- 完整商品管理系統
- Tiptap富文本編輯器
- 個人化價格引擎

### 階段四：購物流程與訂單系統 (3-4週)
**使用方式：**
1. 基於前面階段的商品與客戶系統
2. 生成完整購物流程PRP
3. 實作購物車、結帳、訂單管理

### 階段五：推薦碼分銷系統 (2-3週)
**使用方式：**
1. 參考SRS文件中的推薦碼機制
2. 生成分銷系統PRP
3. 實作URL路由、個人化內容、業務員門戶

### 階段六：Notion同步與最佳化 (2-3週)
**使用方式：**
1. 研究Notion API文件
2. 生成同步模組PRP
3. 實作雙向同步、效能最佳化、部署

## 🛠️ 上下文工程核心概念

### 什麼是上下文工程？

**傳統方式 vs 上下文工程：**

| 傳統Prompt Engineering | 上下文工程 |
|------------------------|-----------|
| 依賴巧妙的提示詞 | 提供完整的專案脈絡 |
| 像給便利貼 | 像寫完整的劇本 |
| AI常常偏離軌道 | AI遵循專案規範 |
| 需要反覆修正 | 一次到位的實作 |

### 上下文工程的優勢

1. **減少AI失誤**：大部分AI失敗不是模型問題，而是上下文不足
2. **確保一致性**：AI遵循專案的模式和慣例
3. **支援複雜功能**：能處理多步驟的複雜實作
4. **自我修正**：驗證循環讓AI能修正自己的錯誤

## 📝 如何撰寫有效的INITIAL.md

### 關鍵要素

1. **功能描述要具體**
   - ❌ 錯誤："建立一個電商網站"
   - ✅ 正確："建立B2B電子煙批發平台，包含個人化定價、推薦碼分銷、Notion同步"

2. **提供具體範例**
   - 在examples/資料夾放置相關程式碼模式
   - 說明哪些模式需要參考
   - 解釋範例的使用方式

3. **列出所有文件資源**
   - API文件連結
   - 函式庫指南
   - MCP伺服器文件
   - 資料庫結構說明

4. **注意重要細節**
   - 認證需求
   - 速率限制
   - 常見陷阱
   - 效能需求

## 🔄 PRP工作流程詳解

### /generate-prp 的執行流程

1. **研究階段**
   - 分析程式碼庫的現有模式
   - 尋找相似的實作
   - 確認要遵循的慣例

2. **文件收集**
   - 取得相關API文件
   - 包含函式庫說明
   - 添加注意事項和限制

3. **藍圖建立**
   - 創建步驟化實作計畫
   - 包含驗證檢查點
   - 添加測試需求

4. **品質檢查**
   - 信心等級評分（1-10）
   - 確保所有上下文都已包含

### /execute-prp 的執行流程

1. **載入上下文**：讀取整個PRP文件
2. **制定計畫**：使用TodoWrite創建詳細任務列表
3. **執行實作**：逐一實現每個元件
4. **驗證檢查**：執行測試和程式碼檢查
5. **迭代修正**：修復發現的問題
6. **確認完成**：確保所有需求都已達成

## 📚 重要文件說明

### INITIAL.md
- 專案核心需求概覽
- 技術架構說明
- 關鍵注意事項

### CLAUDE.md
- 六階段開發規劃
- 程式碼規範與架構原則
- AI助手行為規則
- Windows 11 環境適配

### 商城規劃軟體需求規格生成.md
- 完整的軟體需求規格（SRS）
- 詳細的功能規格說明
- 資料模型與UI/UX設計
- 技術實作細節

## ⚠️ 重要注意事項

### Windows 11 開發環境
- 使用PowerShell執行指令
- 注意路徑格式（使用反斜線）
- Git設定正確的換行符號
- Node.js版本要求18.x以上

### Firebase相關
- 冷啟動延遲問題
- Firestore安全規則先在測試環境驗證
- 並發寫入限制

### Notion API
- 每秒3次請求限制
- 使用Cloud Tasks佇列機制
- 完善的錯誤處理和重試

## 🎯 最佳實踐

1. **總是從INITIAL.md開始**
   - 每次新對話都要先讀取
   - 理解當前開發階段
   - 確認技術架構

2. **善用範例**
   - 在examples/資料夾提供充分範例
   - 展示正確和錯誤的做法
   - 包含錯誤處理模式

3. **使用驗證機制**
   - PRP包含必須通過的測試指令
   - AI會迭代直到所有驗證成功
   - 確保第一次就能產出可用程式碼

4. **充分利用文件**
   - 包含官方API文件
   - 添加MCP伺服器資源
   - 參考特定文件章節

## 📞 支援與回饋

如果在使用過程中遇到問題：
1. 檢查CLAUDE.md中的常見陷阱章節
2. 確認是否遵循了六階段開發流程
3. 驗證Windows 11環境設定
4. 查看相關技術文件

**記錄時間：** 2025年9月2日